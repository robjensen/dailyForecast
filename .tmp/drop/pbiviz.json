{"visual":{"name":"dailyForecast","displayName":"Daily Forecast","guid":"dailyForecast37CCF68C0C98488FA56662385B251C3C","visualClassName":"Visual","version":"0.2.0","description":"Interactive Time-Series forecast","supportUrl":"http://www.mckesson.com","gitHubUrl":""},"author":{"name":"Robert Jensen","email":"Robert.Jensen@mckesson.com"},"apiVersion":"2.6.0","style":"style/visual.less","stringResources":{},"capabilities":{"dataRoles":[{"displayName":"Dates","description":"List of all dates in the sample data set","kind":"GroupingOrMeasure","name":"DateValues"},{"displayName":"Daily volumes","description":"List of all volumes in the sample data set","kind":"GroupingOrMeasure","name":"VolumeValues"},{"displayName":"Date filter","description":"Control to truncate recent transactions and recalculate the forecast","kind":"GroupingOrMeasure","name":"CalcFilter"},{"displayName":"Month-end forecast","description":"Month-end forecast target","kind":"GroupingOrMeasure","name":"MonthForecast"},{"displayName":"Month-end plan","description":"Month-end plan/budget target","kind":"GroupingOrMeasure","name":"MonthPlan"},{"displayName":"Month-End filter","description":"Filter to either expose or hide month-end targets","kind":"GroupingOrMeasure","name":"MonthFilter"}],"dataViewMappings":[{"conditions":[{"DateValues":{"max":1},"SpecialDays":{"max":1},"VolumeValues":{"max":1},"CalcFilter":{"max":1},"MonthForecast":{"max":1},"MonthPlan":{"max":1},"MonthFilter":{"max":1}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"DateValues"}},{"for":{"in":"VolumeValues"}},{"for":{"in":"CalcFilter"}},{"for":{"in":"MonthForecast"}},{"for":{"in":"MonthPlan"}},{"for":{"in":"MonthFilter"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"XML\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn, useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xmlNode(\"script\",attrs = s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xmlNode(\"script\", str, attrs = c(type = \"text/javascript\"))\n        replaceNodes(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xmlNode(\"style\", str)\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  saveXML(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n#################################################\n\nmodel_MTD = function(dframe, conf1, conf2, startDate, endDate, dfSellDays)\r\n{\r\n    freq <- 7\r\n    fcWeeks <- 5\r\n    numFC <- 1\r\n    sizeFramePerFC <- freq*fcWeeks*numFC\r\n    sum_DF <- aggregate(dframe[,2], by=list(DT=dframe[,1]), FUN=sum)\r\n    sum_DF <- sum_DF[!is.na(sum_DF[,2]),]\r\n#    fcStartDate placeholder to align with Daily model   \r\n    holidayp <- calendar[!is.na(calendar$DT)\r\n                         & (calendar$DT <= endDate)\r\n                         & (calendar$DT >= startDate),2]\r\n    \r\n    holidayf <- calendar[!is.na(calendar$DT)\r\n                         & (calendar$DT > endDate)\r\n                         & (calendar$DT <= (endDate + sizeFramePerFC)),2]\r\n    subDate <- as.data.frame(seq(as.Date(startDate), length = endDate - startDate+1, by = \"days\"))\r\n    colnames(subDate)[1] <- \"DT\"\r\n    plotDate <- as.data.frame(seq(as.Date(startDate), length = endDate - startDate+1 + sizeFramePerFC, by = \"days\"))\r\n    colnames(plotDate)[1] <- \"DT\"\r\n\r\n    sum_DF <- full_join(subDate, sum_DF) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),0,.)))\r\n    sum_DF[,2] <- cumsum(sum_DF[,2])\r\n    startingVal <- sum_DF$x[!is.na(sum_DF$DT) & (sum_DF$DT == (endDate - as.numeric(format(endDate, \"%d\"))))]\r\n    startingVal <- if(is_empty(startingVal)==TRUE){\r\n                        startingVal <- 0 \r\n                        } else {\r\n                        startingVal\r\n                        }\r\n    sum_DF[,2] <- sum_DF[,2]-startingVal\r\n\r\n    ts <- ts(sum_DF$x,\r\n            frequency=freq)\r\n#    ts_clean <- tsclean(ts)\r\n#    ts_fit <- ets(ts_clean, model = \"ANA\")\r\n#    ts_fc <- forecast(ts_fit, h=freq*fcWeeks, level = c(conf1, conf2))\r\n    if (length(unique(as.integer(holidayp == 'H'))) == 1) {\r\n      ts_fit <- auto.arima(ts)\r\n      ts_fc <- forecast(ts_fit, h=freq*fcWeeks, level = c(conf1, conf2))\r\n    } else {\r\n      ts_fit <- auto.arima(ts, xreg = as.integer(holidayp == 'H'))\r\n      ts_fc <- forecast(ts_fit, xreg = as.integer(holidayf == 'H'), h=freq*fcWeeks, level = c(conf1, conf2))\r\n    }\r\n\r\n    dframe <- full_join(plotDate, sum_DF) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),0,.)))\r\n\r\n    dframe2 <- cbind(DT = seq(as.Date(endDate)+1, length = sizeFramePerFC, by = \"days\"), \r\n                    forecast = data.frame(ts_fc$mean), \r\n                    upper1 = data.frame(ts_fc$upper[,1]), \r\n                    upper2 = data.frame(ts_fc$upper[,2]), \r\n                    lower1 = data.frame(ts_fc$lower[,1]),\r\n                    lower2 = data.frame(ts_fc$lower[,2]))\r\n    colnames(dframe2)[2] <- \"forecast\"\r\n    colnames(dframe2)[3] <- \"upper1\"\r\n    colnames(dframe2)[4] <- \"upper2\"\r\n    colnames(dframe2)[5] <- \"lower1\"\r\n    colnames(dframe2)[6] <- \"lower2\"\r\n\r\n    dframe <- full_join(dframe, dframe2) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),NA,.)))\r\n    dframe$x[!is.na(dframe$x) & (dframe$DT>endDate)] <- NA\r\n\r\n    dframe <- dframe[!is.na(dframe$DT) & \r\n                    (format(dframe$DT, \"%Y/%m\") == format(endDate+1, \"%Y/%m\")), ]\r\n    dframe$forecast[!is.na(dframe$DT) & (dframe$DT == endDate)] <- \r\n      dframe$x[!is.na(dframe$DT) & (dframe$DT == endDate)]\r\n    dframe$upper1[!is.na(dframe$DT) & (dframe$DT == endDate)] <- \r\n      dframe$x[!is.na(dframe$DT) & (dframe$DT == endDate)]\r\n    dframe$upper2[!is.na(dframe$DT) & (dframe$DT == endDate)] <- \r\n      dframe$x[!is.na(dframe$DT) & (dframe$DT == endDate)]\r\n    dframe$lower1[!is.na(dframe$DT) & (dframe$DT == endDate)] <- \r\n      dframe$x[!is.na(dframe$DT) & (dframe$DT == endDate)]\r\n    dframe$lower2[!is.na(dframe$DT) & (dframe$DT == endDate)] <- \r\n      dframe$x[!is.na(dframe$DT) & (dframe$DT == endDate)]\r\n\r\n    dframe\r\n}\nmodel_Daily = function(dframe, conf1, conf2, startDate, endDate, dfSellDays)\r\n{\r\n    freq <- 7\r\n    fcWeeks <- 5\r\n    numFC <- 1\r\n    sizeFramePerFC <- freq*fcWeeks*numFC    \r\n    sum_DF <- aggregate(dframe[,2], by=list(DT=dframe[,1]), FUN=sum)\r\n    sum_DF <- sum_DF[!is.na(sum_DF[,2]),]\r\n    fcStartDate <- endDate- as.numeric(format(endDate, \"%d\")) + 1\r\n    holidayp <- calendar[!is.na(calendar$DT)\r\n                         & (calendar$DT < fcStartDate)\r\n                         & (calendar$DT >= startDate),2]\r\n    \r\n    holidayf <- calendar[!is.na(calendar$DT)\r\n                         & (calendar$DT >= fcStartDate)\r\n                         & (calendar$DT <= (fcStartDate + sizeFramePerFC - 1)),2]\r\n    subDate <- as.data.frame(seq(as.Date(startDate), length = endDate - startDate+1, by = \"days\"))\r\n    colnames(subDate)[1] <- \"DT\"\r\n    plotDate <- as.data.frame(seq(as.Date(startDate), length = endDate - startDate+1 + sizeFramePerFC, by = \"days\"))\r\n    colnames(plotDate)[1] <- \"DT\"\r\n\r\n    sum_DF <- full_join(subDate, sum_DF) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),0,.)))\r\n#    sum_DF[,2] placeholder to align with MTD model\r\n#    startingVal placeholder to align with MTD model\r\n#    sum_DF[,2] placeholder to align with MTD model\r\n\r\n    ts <- ts(sum_DF$x[!is.na(sum_DF$DT) & (sum_DF$DT <= (endDate - as.numeric(format(endDate, \"%d\"))))],\r\n            frequency=freq)\r\n#    ts_clean <- tsclean(ts)\r\n#    ts_fit <- ets(ts_clean, model = \"ANA\")\r\n#    ts_fc <- forecast(ts_fit, h=freq*fcWeeks) ###HOW TO CHANGE THIS INDEX TO A DATE\r\n    \r\n    if (length(unique(as.integer(holidayp == 'H'))) == 1) {\r\n        ts_fit <- auto.arima(ts)\r\n        ts_fc <- forecast(ts_fit, h=freq*fcWeeks, level = c(conf1, conf2))\r\n    } else {\r\n    ts_fit <- auto.arima(ts, xreg = as.integer(holidayp == 'H'))\r\n    ts_fc <- forecast(ts_fit, xreg = as.integer(holidayf == 'H'), h=freq*fcWeeks, level = c(conf1, conf2))\r\n    }\r\n\r\n    dframe <- full_join(plotDate, sum_DF) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),0,.)))\r\n\r\n    dframe2 <- cbind(DT = seq(as.Date(fcStartDate), length = sizeFramePerFC, by = \"days\"),\r\n                    forecast = data.frame(ts_fc$mean),\r\n                    upper1 = data.frame(ts_fc$upper[,1]),\r\n                    upper2 = data.frame(ts_fc$upper[,2]),\r\n                    lower1 = data.frame(ts_fc$lower[,1]),\r\n                    lower2 = data.frame(ts_fc$lower[,2]))\r\n    colnames(dframe2)[2] <- \"forecast\"\r\n    colnames(dframe2)[3] <- \"upper1\"\r\n    colnames(dframe2)[4] <- \"upper2\"\r\n    colnames(dframe2)[5] <- \"lower1\"\r\n    colnames(dframe2)[6] <- \"lower2\"\r\n\r\n    dframe <- full_join(dframe, dframe2) %>% group_by(DT) %>% mutate_all(funs(ifelse(is.na(.),NA,.)))\r\n    dframe$x[!is.na(dframe$x) & (dframe$DT>endDate)] <- NA\r\n\r\n    dframe <- dframe[!is.na(dframe$DT) &\r\n                    (format(dframe$DT, \"%Y/%m\") == format(endDate+1, \"%Y/%m\")), ]\r\n\r\n    dframe\r\n}\n# source('https://mckessoncorp.sharepoint.com/:u:/s/GRPmmsfinance89/ETUa56-d-RpImK-TqHKhhBABjVJicW1VUxFIECDoE0s9xA?e=pXoHq9')\n# source('https://mckessoncorp.sharepoint.com/:u:/s/GRPmmsfinance89/EXWV76YNcmlCoWJX_MbiMt8BSYasmZ_I4vu0usNfkxAikQ?e=5yXqHN')\n#`calendar` = read.csv('./assets/V_DIM_PERIOD.csv', check.names = FALSE, encoding = \"UTF-8\", blank.lines.skip = FALSE);\ncalendar <- as.data.frame(as.Date(seq(as.Date('2018-01-01'), as.Date('2019-12-31'),by = 1)))\ncolnames(calendar)[1] <- \"DT\"\ncalendar$SELL_DAY_FLG <- c('H','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','H','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','H','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','H','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','H','H','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','H','Y','Y','Y','N','N','Y','H','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','H','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','H','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','H','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N',\n                            'Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','H','H','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','Y','Y','Y','N','N','Y','Y','H','Y','Y','N','N',\n                            'Y','Y')\n\n#source('https://mckessoncorp.sharepoint.com/:u:/r/sites/GRPmmsfinance89/Shared%20Documents/Daily%20Sales%20Scripts/DailySalesForecast.r?csf=1&e=CJy0Zy')\n#fname <- tempfile()\n#download.file(\"https://mckessoncorp.sharepoint.com/:u:/r/sites/GRPmmsfinance89/Shared%20Documents/Daily%20Sales%20Scripts/DailySalesForecast.r?csf=1&e=CJy0Zy\", fname, method=\"wget\")\n#source(fname)\n#unlink(fname)\n\n\n############### Library Declarations ###############\n#libraryRequireInstall(\"ggplot2\");\n#libraryRequireInstall(\"plotly\");\nlistPackages <- c(\"curl\",\"Rcpp\",\"zoo\",\"xts\",\"colorspace\",\"TTR\",\"scales\",\"munsell\",\"lazyeval\",\"plyr\",\"tibble\",\"rlang\",\"tseries\",\"forecast\",\"data.table\", \"dplyr\", \"bindrcpp\", \"glue\",\"purrr\",\"ggplot2\",\"htmltools\",\"plotly\",\"XML\")\n\nfor (i in 1:length(listPackages)) {\n  if(require(listPackages[i], character.only = TRUE)){\n    print(paste(listPackages[i],\"is loaded correctly\", sep = \" \", collapse = NULL))\n  } else {\n    print(paste(\"Trying to install\",listPackages[i], sep = \" \", collapse = NULL))\n    install.packages(listPackages[i], repos='http://cran.us.r-project.org')\n    if(require(listPackages[i], character.only = TRUE)){\n      print(paste(listPackages[i], \"installed and loaded\", sep = \" \", collapse = NULL))\n    } else {\n#      stop(paste(\"could not install\",listPackages[i], sep = \" \", collapse = NULL))\n      warning(paste(\"could not install\",listPackages[i], sep = \" \", collapse = NULL))\n    }\n  }\n}\n\n####################################################\n############ User Parameters #########\n\n##PBI_PARAM Forecasting model\n#Type:string, Default:\"blue\", Range:NA, PossibleValues:\"daily\", \"mtd\"\nforecastmodel = \"mtd\"\nif(exists(\"settings_model_params_forecastmodel\")){\n  forecastmodel = settings_model_params_forecastmodel\n}\n\n##PBI_PARAM Color of actual\n#Type:string, Default:\"blue\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\",hex\nlineColorActual = \"#000000\"\nif(exists(\"settings_tseries_params_lineColorActual\")){\n  lineColorActual = settings_tseries_params_lineColorActual\n}\n\n##PBI_PARAM Size of actual line\n#Type:numeric, Default: 1, Range:NA, PossibleValues:NA, Remarks: NA\nlineWeightActual = 1\nif(exists(\"settings_tseries_params_lineWeightActual\")){\n  lineWeightActual = settings_tseries_params_lineWeightActual/10\n}\n\n##PBI_PARAM Color of timeseries forecast\n#Type:string, Default:\"#005A8C\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\",hex\nlineColorModel = \"#005A8C\"\nif(exists(\"settings_tseries_params_lineColorModel\")){\n  lineColorModel = settings_tseries_params_lineColorModel\n}\n\n##PBI_PARAM Size of timeseries forecast line\n#Type:string, Default: 1, Range:NA, PossibleValues:NA, Remarks: NA\nlineWeightModel = 1\nif(exists(\"settings_tseries_params_lineWeightModel\")){\n  lineWeightModel = settings_tseries_params_lineWeightModel/10\n}\n\n##PBI_PARAM Color of month-end plan\n#Type:string, Default:\"blue\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\", hex\nlineColorPlan = \"#000000\"\nif(exists(\"settings_plan_params_lineColor\")){\n  lineColor = settings_plan_params_lineColor\n}\n\n##PBI_PARAM Size of month-end plan line\n#Type:string, Default: 1, Range:NA, PossibleValues:NA, Remarks: NA\nlineWeightPlan = 1\nif(exists(\"settings_plan_params_weight\")){\n  lineWeightPlan = settings_plan_params_weight/10\n}\n\n##PBI_PARAM Color of month-end forecast\n#Type:string, Default:\"blue\", Range:NA, PossibleValues:\"orange\",\"blue\",\"green\",\"black\", hex\nlineColorForecast = \"#EF8200\"\nif(exists(\"settings_forecast_params_lineColor\")){\n  lineColor = settings_forecast_params_lineColor\n}\n\n##PBI_PARAM Size of month-end forecast line\n#Type:string, Default: 1, Range:NA, PossibleValues:NA, Remarks: NA\nlineWeightForecast = 1\nif(exists(\"settings_forecast_params_weight\")){\n  lineWeightForecast = settings_forecast_params_weight/10\n}\n\n# Set of parameters from GUI\n#PBI_PARAM Confidence level line\n#Type:numeric, Default: 0.8 , Range:[0,1], PossibleValues:NA, Remarks: GUI input is predefined set of values\nconf1 = 0.8\nif(exists(\"settings_tseries_params_conf1\")){\n  conf1 = as.numeric(settings_tseries_params_conf1)\n}\n\n#PBI_PARAM Confidence level line #2\n#Type:numeric, Default: 0.95 , Range:[0,1], PossibleValues:NA, Remarks: NA\nconf2 = 0.95\nif(exists(\"settings_tseries_params_conf2\")){\n  conf2 = as.numeric(settings_tseries_params_conf2)\n}\n\n#PBI_PARAM Size of labels on axes\nsizeLabel = 12\nif(exists(\"settings_axes_params_textSize\")){\n  sizeLabel = settings_axes_params_textSize\n}\n\n###############Internal parameters definitions#################\n# Set of parameters, which are not exported to GUI\n\n###############Internal functions definitions#################\n\n# return FALSE if canvas is too small\n# goodPlotDimension = function(minWidthInch = 3,minHeightInch = 2.2)\n# {\n#   re = (par()$din[1] > minWidthInch) & (par()$din[2] > minHeightInch)\n#   return(re)\n# }\n\n\n############# Input validation & initializations ############# \ncolnames(calendar)[1] <- \"DT\"\ncalendar$DT <- as.Date(calendar$DT, format = \"%m/%d/%Y\")\n\nif(conf2 < conf1)# swap\n{   temp = conf1; conf1 = conf2; conf2 = temp}\n\nvalidToPlot = TRUE\n\npbiWarning = \"\"\n\n# gpd = goodPlotDimension()\n\n\n################### Actual code ####################\n\n#dataset <- Values\n\n#if(exists(\"SpecialDays\")){\n#  dataset <- cbind(DateValues,VolumeValues,SpecialDays)\n#}else{\n  dataset <- cbind(DateValues,VolumeValues)\n#}\ndataset[,1] <- as.Date(dataset[,1], format = \"%Y-%m-%d\")\n#dataset[,3] <- as.Date(dataset[,3], format = \"%Y-%m-%d\")\ncolnames(dataset)[1] <- \"DT\"\n\nstartDate <- min(as.Date(dataset$DT[!is.na(dataset[,2])], format = \"%Y-%m-%d\"))\nendDate <- max(as.Date(dataset$DT[!is.na(dataset[,2])], format = \"%Y-%m-%d\"))\n\nif(exists(\"CalcFilter\")){\n  DateFilter <- as.Date(CalcFilter[1,1], format = \"%Y-%m-%d\")\n  endDate <- min(endDate, DateFilter)\n}\n\nif(exists(\"MonthFilter\")){\n  boolFilter <- length(unique(MonthFilter[,1])) == 1\n}else{\n  boolFilter <- FALSE\n}\n\ndataset <- dataset[!is.na(\"DT\") & (dataset$DT <= endDate), ]\n\nif(forecastmodel == \"mtd\"){\n  dframe <- model_MTD(dframe = dataset,\n                      conf1 = conf1,\n                      conf2 = conf2,\n                      startDate = startDate,\n                      endDate = endDate,\n                      dfSellDays = calendar)\n}\nif(forecastmodel == \"daily\"){\n  dframe <- model_Daily(dframe = dataset,\n                        conf1 = conf1,\n                        conf2 = conf2,\n                        startDate = startDate,\n                        endDate = endDate,\n                        dfSellDays = calendar)\n}\n\nif(exists(\"MonthForecast\")){\n  fcast <- MonthForecast[1,1]\n  dframe$fcst <- fcast\n}else{\n  fcast <- 0\n}\nif(exists(\"MonthPlan\")){\n  plan <- MonthPlan[1,1]\n  dframe$plan <- plan\n}else{\n  plan <- 0\n}\n\n\naxisValue <- c(10^0,10^3,10^6, 10^9)\naxisLabel <- c(\"$\",\"$K\",\"$M\",\"$B\")\naxisScaling <- data.frame(axisValue)\naxisScaling$axisLabel <- axisLabel\naxisScale <- tail(axisScaling[!is.na(axisScaling$axisValue) &\n                                (axisScaling$axisValue < max(abs(dframe$forecast[!is.na(dframe$forecast)]))), ], n = 1L)\n\nmytheme <- theme_classic() + theme(axis.line = element_line(colour = \"#005A8C\"),\n                                   panel.grid.major = element_blank(),\n                                   panel.grid.minor = element_blank(),\n                                   panel.border = element_blank(),\n                                   panel.background = element_blank(),\n                                   axis.ticks = element_line(colour = \"#005A8C\"),\n                                   axis.text = element_text(colour = \"#005A8C\"),\n                                   text = element_text(colour = \"#005A8C\",\n                                                       size = sizeLabel),\n                                   axis.text.y = element_text(angle = 0)\n)\n\ngg <- ggplot(dframe, aes(x = DT, y = x)) + \n      geom_line(color = 'black', size=lineWeightActual) +\n      geom_line(aes(x = DT, y = forecast),\n                data = dframe,\n                color = 'blue', size=lineWeightModel) +\n      geom_ribbon(aes(x = DT, \n                      ymax = upper1, \n                      ymin = lower1),\n                  data=dframe,\n                  alpha = 0.33,\n                  fill = \"#005A8C\") +\n      geom_ribbon(aes(x = DT, \n                      ymax = upper2, \n                      ymin = lower2),\n                  data=dframe,\n                  alpha = 0.33,\n                  fill = \"#005A8C\") +\n      mytheme + \n      labs(x = NULL,\n           caption = paste(\"(based on data through \", format(endDate , \"%b %d, %Y\"),\")\", sep = \"\")) +\n      scale_y_continuous(name = axisScale$axisLabel, labels = function(x) x/axisScale$axisValue)\nif (fcast != 0 & boolFilter == TRUE) {\n  gg <- gg +       geom_line(aes(x = DT, y = fcast),\n                             data = dframe,\n                             color = lineColorForecast, size=lineWeightForecast)\n}\nif (plan != 0 & boolFilter == TRUE) {\n  gg <- gg + geom_line(aes(x = DT, y = plan),\n                       data = dframe,\n                       color = lineColorPlan, size=lineWeightPlan)\n}\n####################################################\n\n############# Create and save widget ###############\np = ggplotly(gg) %>% \n  config(displayModeBar = FALSE) %>% \n  layout(dragmode = \"pan\",\n         hovermode = \"x\",\n         margin = list(l = 50,\n                       t = 0,\n                       r = 0,\n                       b = 20,\n                       pad = 0),\n         xaxis = list(fixedrange = TRUE),\n         yaxis = list(fixedrange = TRUE));\n\n# Custom formatting depending on whether forecast is daily or MTD\n# Daily forecast has a data series (midpoint timeseries forecast)\n# which has values for every day.  We will use this series to present\n# the date value for the tooltip\n#\n# MTD forecast does not have a reliable data series that spans all dates,\n# so the date value will be displayed in both the midpoint timeseries\n# forecast as well as the Actuals series\nif(forecastmodel==\"mtd\"){\n  p$x$data[[1]]$text[!is.na(p$x$data[[1]]$y)] <-\n    paste(\"Date:\",format(dframe$DT,\n                        \"%b %d\"),\"<br />\",\n          \"Actual:\",round(p$x$data[[1]]$y[!is.na(p$x$data[[1]]$y)]/axisScale$axisValue,1));\n}else{\n  p$x$data[[1]]$text[!is.na(p$x$data[[1]]$y)] <-\n    paste(\"Actual:\",round(p$x$data[[1]]$y[!is.na(p$x$data[[1]]$y)]/axisScale$axisValue,1));\n}\n        \nif(forecastmodel==\"mtd\"){\n  p$x$data[[2]]$text[!is.na(p$x$data[[2]]$y)] <-\n    paste(\"Date:\",format(dframe$DT[length(p$x$data[[1]]$x[!is.na(p$x$data[[1]]$y)]):length(dframe$DT)],\n                        \"%b %d\"),\"<br />\",\n          \"Projection:\",round(p$x$data[[2]]$y[!is.na(p$x$data[[2]]$y)]/axisScale$axisValue,1));\n}else{\n  p$x$data[[2]]$text[!is.na(p$x$data[[2]]$y)] <-\n  paste(\"Date:\",format(dframe$DT,\n                       \"%b %d\"),\"<br />\",\n        \"Projection:\",round(p$x$data[[2]]$y[!is.na(p$x$data[[2]]$y)]/axisScale$axisValue,1));\n}\n\n#Prediction interval 1\nvector_1 <- \n  paste0(\"Hi \",conf1*100,\": \",round(p$x$data[[3]]$y[c((length(p$x$data[[3]]$y)-1):\n                                               (length(p$x$data[[3]]$y)/2+1))]/axisScale$axisValue,1),\n         \"<br />\",\n         \"Low \",conf1*100,\": \",round(p$x$data[[3]]$y[c(1:\n                                           (length(p$x$data[[3]]$y)/2)-1)]/axisScale$axisValue,1))\np$x$data[[3]]$text <- c(vector_1,vector_1[length(vector_1)],vector_1[length(vector_1):1],vector_1[1]);\n\n#Prediction interval 2\nvector_2 <- \n  paste0(\"Hi \",conf2*100,\": \",round(p$x$data[[4]]$y[c((length(p$x$data[[4]]$y)-1):\n                                           (length(p$x$data[[4]]$y)/2+1))]/axisScale$axisValue,1),\n         \"<br />\",\n         \"Low \",conf2*100,\": \",round(p$x$data[[4]]$y[c(1:\n                                           (length(p$x$data[[4]]$y)/2)-1)]/axisScale$axisValue,1))\np$x$data[[4]]$text <- c(vector_2,vector_2[length(vector_2)],vector_2[length(vector_2):1],vector_2[1]);\n\nif (fcast != 0 & boolFilter == TRUE) {\n  p$x$data[[5]]$text <- paste0(\"Forecast: \",round(p$x$data[[5]]$y/axisScale$axisValue,1));\n}\nif (plan != 0 & boolFilter == TRUE) {\n  p$x$data[[6]]$text <- paste0(\"Plan: \",round(p$x$data[[6]]$y/axisScale$axisValue,1));\n}\n\ninternalSaveWidget(p, 'out.html');\n####################################################\n"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}},"settings_model_params":{"displayName":"Forecasting Model","description":"Forecasting Model","properties":{"forecastmodel":{"displayName":"Forecasting Model","description":"Forecasting Model","type":{"enumeration":[{"displayName":"Daily","value":"daily"},{"displayName":"Month-To-Date","value":"mtd"}]}}}},"settings_tseries_params":{"displayName":"Time Series Settings","description":"Time Series settings","properties":{"lineColorActual":{"displayName":"Actual line color","description":"Define color for actual historical data","type":{"fill":{"solid":{"color":true}}}},"lineWeightActual":{"displayName":"Actual line weight","description":"Weight of line for actual historical data","type":{"numeric":true}},"lineColorModel":{"displayName":"Forecast line color","description":"Define color for forecasted timeseries data","type":{"fill":{"solid":{"color":true}}}},"lineWeightModel":{"displayName":"Forecast line weight","description":"Weight of line for forecasted timeseries data","type":{"numeric":true}},"conf1":{"displayName":"Prediction level #1","description":"Prediction level #1","type":{"enumeration":[{"displayName":"0.50","value":"0.5"},{"displayName":"0.75","value":"0.75"},{"displayName":"0.80","value":"0.8"},{"displayName":"0.85","value":"0.85"},{"displayName":"0.90","value":"0.9"},{"displayName":"0.95","value":"0.95"},{"displayName":"0.975","value":"0.975"},{"displayName":"0.99","value":"0.99"},{"displayName":"0.995","value":"0.995"},{"displayName":"0.999","value":"0.999"}]}},"conf2":{"displayName":"Prediction level #2","description":"Prediction level #2","type":{"enumeration":[{"displayName":"0.50","value":"0.5"},{"displayName":"0.75","value":"0.75"},{"displayName":"0.80","value":"0.8"},{"displayName":"0.85","value":"0.85"},{"displayName":"0.90","value":"0.9"},{"displayName":"0.95","value":"0.95"},{"displayName":"0.975","value":"0.975"},{"displayName":"0.99","value":"0.99"},{"displayName":"0.995","value":"0.995"},{"displayName":"0.999","value":"0.999"}]}}}},"settings_forecast_params":{"displayName":"Month-End Forecast Settings","description":"Forecast settings","properties":{"lineColor":{"displayName":"Line color","type":{"fill":{"solid":{"color":true}}}},"weight":{"displayName":"Line weight","type":{"numeric":true}}}},"settings_plan_params":{"displayName":"Month-End Plan Settings","description":"Plan settings","properties":{"lineColor":{"displayName":"Line color","type":{"fill":{"solid":{"color":true}}}},"weight":{"displayName":"Line weight","type":{"numeric":true}}}},"settings_axes_params":{"displayName":"Axes","description":"Axes and labels settings","properties":{"textSize":{"displayName":"Labels size","type":{"numeric":true}},"sizeTicks":{"displayName":"Size ticks","description":"Size ticks","type":{"enumeration":[{"displayName":"4","value":"4"},{"displayName":"6","value":"6"},{"displayName":"8","value":"8"},{"displayName":"10","value":"10"},{"displayName":"12","value":"12"},{"displayName":"14","value":"14"},{"displayName":"16","value":"16"},{"displayName":"18","value":"18"},{"displayName":"20","value":"20"}]}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"curl","displayName":"curl","url":"https://cran.r-project.org/web/packages/curl/index.html"},{"name":"Rcpp","displayName":"Rcpp","url":"https://cran.r-project.org/web/packages/Rcpp/index.html"},{"name":"zoo","displayName":"zoo","url":"https://cran.r-project.org/web/packages/zoo/index.html"},{"name":"xts","displayName":"xts","url":"https://cran.r-project.org/web/packages/xts/index.html"},{"name":"colorspace","displayName":"colorspace","url":"https://cran.r-project.org/web/packages/colorspace/index.html"},{"name":"TTR","displayName":"TTR","url":"https://cran.r-project.org/web/packages/TTR/index.html"},{"name":"scales","displayName":"scales","url":"https://cran.r-project.org/web/packages/scales/index.html"},{"name":"munsell","displayName":"munsell","url":"https://cran.r-project.org/web/packages/munsell/index.html"},{"name":"lazyeval","displayName":"lazyeval","url":"https://cran.r-project.org/web/packages/lazyeval/index.html"},{"name":"plyr","displayName":"plyr","url":"https://cran.r-project.org/web/packages/plyr/index.html"},{"name":"tibble","displayName":"tibble","url":"https://cran.r-project.org/web/packages/tibble/index.html"},{"name":"rlang","displayName":"rlang","url":"https://cran.r-project.org/web/packages/rlang/index.html"},{"name":"tseries","displayName":"tseries","url":"https://cran.r-project.org/web/packages/tseries/index.html"},{"name":"forecast","displayName":"forecast","url":"https://cran.r-project.org/web/packages/forecast/index.html"},{"name":"data.table","displayName":"data.table","url":"https://cran.r-project.org/web/packages/data.table/index.html"},{"name":"dplyr","displayName":"dplyr","url":"https://cran.r-project.org/web/packages/dplyr/index.html"},{"name":"bindrcpp","displayName":"Bind Rcpp","url":"https://cran.r-project.org/web/packages/bindrcpp/index.html"},{"name":"glue","displayName":"glue","url":"https://cran.r-project.org/web/packages/glue/index.html"},{"name":"purrr","displayName":"purrr","url":"https://cran.r-project.org/web/packages/purrr/index.html"},{"name":"htmltools","displayName":"HTML Tools","url":"https://cran.r-project.org/web/packages/htmltools/index.html"},{"name":"XML","displayName":"XML","url":"https://cran.r-project.org/web/packages/XML/index.html"},{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"}]},"content":{"js":"var dailyForecast37CCF68C0C98488FA56662385B251C3C=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"assets\",n(n.s=12)}([function(e,t,n){\"use strict\";(function(e){n.d(t,\"b\",function(){return o}),n.d(t,\"a\",function(){return i}),n.d(t,\"c\",function(){return s});var r=0;function o(){r=0}function i(e,t){var n=[];if(e&&e.hasChildNodes()){for(var r=e.children,o=0;o<r.length;o++){var i=void 0;i=\"script\"===r.item(o).nodeName.toLowerCase()?a(r.item(o)):r.item(o).cloneNode(!0),t.appendChild(i),n.push(i)}return n}}function a(e){for(var t=document.createElement(\"script\"),n=e.attributes,o=0;o<n.length;o++)t.setAttribute(n[o].name,n[o].textContent),\"src\"===n[o].name.toLowerCase()&&(r++,t.onload=function(){r--});return t.innerHTML=e.innerHTML,t}function s(){var t=e.setInterval(function(){0===r&&(e.clearInterval(t),e.hasOwnProperty(\"HTMLWidgets\")&&e.HTMLWidgets.staticRender&&e.HTMLWidgets.staticRender())},100)}}).call(this,n(4))},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return a});var r=n(2);function o(e){return(o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e,t,n){return e?r.a(e[t.objectName],t.propertyName,n):n}function a(e,t,n){var r=i(e,t,n);return r&&r.solid?r.solid.color:null==r||\"object\"===o(r)&&!r.solid?n:r}},function(e,t,n){\"use strict\";function r(e,t,n){if(!e)return n;var r=e[t];return void 0===r?n:r}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e){return(r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function i(e,t){return!t||\"object\"!==r(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,\"a\",function(){return c});var u=n(7).a.DataViewObjectsParser,c=function(e){function t(){var e;return o(this,t),(e=i(this,a(t).apply(this,arguments))).settings_model_params=new l,e.settings_tseries_params=new f,e.settings_forecast_params=new p,e.settings_plan_params=new d,e.settings_axes_params=new y,e}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,u),t}(),l=function e(){o(this,e),this.forecastmodel=\"mtd\"},f=function e(){o(this,e),this.lineColorActual=\"#000000\",this.lineWeightActual=10,this.lineColorModel=\"#005A8C\",this.lineWeightModel=10,this.conf1=\"0.8\",this.conf2=\"0.95\"},p=function e(){o(this,e),this.lineColor=\"#EF8200\",this.weight=10},d=function e(){o(this,e),this.lineColor=\"#000000\",this.weight=10},y=function e(){o(this,e),this.textSize=12,this.sizeTicks=\"6\"}},function(e,t){e.exports=Function(\"return this\")()},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return u});var r,o=n(3),i=n(0);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Data=2]=\"Data\",e[e.Resize=4]=\"Resize\",e[e.ViewMode=8]=\"ViewMode\",e[e.Style=16]=\"Style\",e[e.ResizeEnd=32]=\"ResizeEnd\",e[e.All=62]=\"All\"}(r||(r={}));var s=[r.Resize,r.ResizeEnd,r.Resize+r.ResizeEnd],u=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),e&&e.element&&(this.rootElement=e.element),this.headNodes=[],this.bodyNodes=[]}var n,r,u;return n=t,u=[{key:\"parseSettings\",value:function(e){return o.a.parse(e)}}],(r=[{key:\"update\",value:function(e){if(e&&e.type&&e.viewport&&e.dataViews&&0!==e.dataViews.length&&e.dataViews[0]){var n=e.dataViews[0];this.settings=t.parseSettings(n);var r=null;n.scriptResult&&n.scriptResult.payloadBase64&&(r=n.scriptResult.payloadBase64),-1===s.indexOf(e.type)?r&&this.injectCodeFromPayload(r):this.onResizing(e.viewport)}}},{key:\"onResizing\",value:function(e){}},{key:\"injectCodeFromPayload\",value:function(t){if(Object(i.b)(),t){var n=document.createElement(\"html\");try{n.innerHTML=e.atob(t)}catch(e){return}if(0===this.headNodes.length){for(;this.headNodes.length>0;){var r=this.headNodes.pop();document.head.removeChild(r)}var o=n.getElementsByTagName(\"head\");if(o&&o.length>0){var a=o[0];this.headNodes=Object(i.a)(a,document.head)}}for(;this.bodyNodes.length>0;){var s=this.bodyNodes.pop();this.rootElement.removeChild(s)}var u=n.getElementsByTagName(\"body\");if(u&&u.length>0){var c=u[0];this.bodyNodes=Object(i.a)(c,this.rootElement)}Object(i.c)()}}},{key:\"enumerateObjectInstances\",value:function(e){return o.a.enumerateObjectInstances(this.settings||o.a.getDefault(),e)}}])&&a(n.prototype,r),u&&a(n,u),t}()}).call(this,n(4))},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"DataViewObjectsParser\",function(){return i});var r=n(1);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e)}var t,n,i;return t=e,i=[{key:\"getDefault\",value:function(){return new this}},{key:\"createPropertyIdentifier\",value:function(e,t){return{objectName:e,propertyName:t}}},{key:\"parse\",value:function(e){var t,n=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return n;for(var o in t=n.getProperties())for(var i in t[o]){var a=n[o][i];n[o][i]=r.a(e.metadata.objects,t[o][i],a)}return n}},{key:\"isPropertyEnumerable\",value:function(t){return!e.InnumerablePropertyPrefix.test(t)}},{key:\"enumerateObjectInstances\",value:function(e,t){var n=e&&e[t.objectName];if(!n)return[];var r={objectName:t.objectName,selector:null,properties:{}};for(var o in n)n.hasOwnProperty(o)&&(r.properties[o]=n[o]);return{instances:[r]}}}],(n=[{key:\"getProperties\",value:function(){var t=this,n={};return Object.keys(this).forEach(function(r){if(e.isPropertyEnumerable(r)){var o=Object.keys(t[r]);n[r]={},o.forEach(function(t){e.isPropertyEnumerable(r)&&(n[r][t]=e.createPropertyIdentifier(r,t))})}}),n}}])&&o(t.prototype,n),i&&o(t,i),e}();i.InnumerablePropertyPrefix=/^_/},function(e,t,n){\"use strict\";var r=n(6);n.d(t,\"a\",function(){return r})},,,,,function(e,t,n){e.exports=n(13)},function(e,t,n){\"use strict\";n.r(t),function(e){var r=n(5),o=e.powerbi,i={name:\"dailyForecast37CCF68C0C98488FA56662385B251C3C\",displayName:\"Daily Forecast\",class:\"Visual\",version:\"0.2.0\",apiVersion:\"2.6.0\",create:function(e){if(r.a)return new r.a(e);console.error(\"Visual instance not found\")},custom:!0};void 0!==o&&(o.visuals=o.visuals||{},o.visuals.plugins=o.visuals.plugins||{},o.visuals.plugins.dailyForecast37CCF68C0C98488FA56662385B251C3C=i),t.default=i}.call(this,n(4))}]);\n//# sourceMappingURL=visual.js.map","css":"","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADZGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOkE4QkYzOTE3Q0FEM0UwMTFBNzFDQkU4Mjc4MEJBQTlFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjc0RjVCMDU1RDQ5MDExRTBBODFEQjY2MzEyQ0QxQ0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjc0RjVCMDU0RDQ5MDExRTBBODFEQjY2MzEyQ0QxQ0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjkyOTlENTU4MEZENEUwMTFBNzFDQkU4Mjc4MEJBQTlFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkE4QkYzOTE3Q0FEM0UwMTFBNzFDQkU4Mjc4MEJBQTlFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+kOg1fQAAAPRJREFUOE+tky0OwkAQRncRKBQKJJKEOwCCBI6A5BIYNIYjITgBKEiQyGJwKEzpN+lHptOGbn9eUna2yb68bYKPE1xNoucnnZy73d+yduS3IZTtD4/6QtZpGagl1Fe1VPqGVmTrdttReCFkFAArI0FCynAYa5EMdSBISBmwK6BsMu6Vf0PUrTfXdJdHy0BpIa8HeJhYGfhbqOu0DNe1suGgK2uu0HufTnlwGA9knCGiDGQKtQyvZ6uLzLpGHy7iV2jL7H4x75fKBBQCjNxyni7P8fH0knehSCFrkn1mBSirgnxDK2xC0D+lCkiTrDbqQMuFzn0B7kXEvcwSUxcAAAAASUVORK5CYII="},"visualEntryPoint":""}